<!DOCTYPE html>
<!-- HTML5 Boilerplate -->
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

<head>

	<meta charset="utf-8">
	<!-- Always force latest IE rendering engine & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Good Morning</title>
	<meta name="description" content="Dawn Simulator">

	<meta http-equiv="cleartype" content="on">

	<!-- Responsive and mobile friendly stuff -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
    <script src="js/jquery.knob.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/sparkjs/0.5.9/spark.min.js"></script>
    <script>
        $(function($) {
			var Red = 0;
			var Green = 0;
			var Blue = 0;
			var White = 0;
			var analog_values = new Uint8Array(2);
			var value_byte1;
			var value_byte2;
			
			$(document).ready(function(){
				$.get("https://api.spark.io/v1/devices/54ff6d066672524818311167/red?access_token=e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
						function(data, status){
							Red = data.result;
							console.log(data.result);});
				$.get("https://api.spark.io/v1/devices/54ff6d066672524818311167/green?access_token=e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
						function(data){
							Green = data;});
				$.get("https://api.spark.io/v1/devices/54ff6d066672524818311167/blue?access_token=e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
						function(data){
							Blue = data;});
				$.get("https://api.spark.io/v1/devices/54ff6d066672524818311167/white?access_token=e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
						function(data){
							White = data;});
                setBackground(Red,Green,Blue,White);
            }) 
			function setBackground(r, g, b,w){
				r = Math.round(((w/255)*r/2) + r/2);
				g = Math.round(((w/255)*g/2) + g/2);
				b = Math.round(((w/255)*b/2) + b/2);
				var color = "#"+("0" + r.toString(16)).slice(-2)+("0" + g.toString(16)).slice(-2) + ("0" + b.toString(16)).slice(-2);
				
                console.log(color);
				document.body.style.background = color;
			}
			
			function breakAnalogValue(v){
				var return_values = new Uint8Array(2);
            	if(v < 128){
                	return_values[0] = v;
                	return_values[1] = 0;
            	} else {
                	return_values[0] = 127;
                	return_values[1] = v-127;
            	}
				return return_values;
			}
			
            $(".Red").knob({
                change : function (value) {
                    console.log("change Red: " + value);
					Red = Math.round(value);
                    setBackground(Red,Green,Blue,White);
                },
                release : function (value) {
                	analog_values = breakAnalogValue(value);
                    $.post("https://api.spark.io/v1/devices/54ff6d066672524818311167/controlPanel", 
                    	   {access_token: "e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
                        	args: String.fromCharCode(1, analog_values[0], analog_values[1])
                    	   });
                    console.log(analog_values);
                },
                cancel : function () {
                    console.log("cancel Red: ", this);
                },
            });
            $(".Green").knob({
                change : function (value) {
                    console.log("change Green: " + value);
					Green = Math.round(value);
                    setBackground(Red,Green,Blue,White);
                },
                release : function (value) {
                	analog_values = breakAnalogValue(value);
                    $.post("https://api.spark.io/v1/devices/54ff6d066672524818311167/controlPanel", 
                    	   {access_token: "e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
                        	args: String.fromCharCode(2, analog_values[0], analog_values[1])
                    	   });
                    console.log(analog_values);
                },
                cancel : function () {
                    console.log("cancel Green: ", this);
                },
                /*format : function (value) {
                    return value + '%';
                },*/
            });
            $(".Blue").knob({
                change : function (value) {
                    console.log("change Blue: " + value);
					Blue = Math.round(value);
                    setBackground(Red,Green,Blue,White);
                },
                release : function (value) {
                	analog_values = breakAnalogValue(value);
                    $.post("https://api.spark.io/v1/devices/54ff6d066672524818311167/controlPanel", 
                    	   {access_token: "e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
                        	args: String.fromCharCode(3, analog_values[0], analog_values[1])
                    	   });
                    console.log(analog_values);
                },
                cancel : function () {
                    console.log("cancel Blue: ", this);
                },
                /*format : function (value) {
                    return value + '%';
                },*/
            });
            $(".White").knob({
                change : function (value) {
                    console.log("change White: " + value);
					White = Math.round(value);
                    setBackground(Red,Green,Blue,White);
                },
                release : function (value) {
                	analog_values = breakAnalogValue(value);
                    $.post("https://api.spark.io/v1/devices/54ff6d066672524818311167/controlPanel", 
                    	   {access_token: "e5ea3c17b273092f7d5da9cb5c3411a24e3b5d76",
                        	args: String.fromCharCode(4, analog_values[0], analog_values[1])
                    	   });
                    console.log(analog_values);
                },
                cancel : function () {
                    console.log("cancel White: ", this);
                },
            });
        });
    </script>


	<!-- Stylesheets -->
	<link rel="stylesheet" href="css/main.css" media="all">

</head>

<body>
	<div class="header">
	</div>
	<div class="section group">
            <div style="position:relative;width:300px;margin:auto">
                <div style="position:absolute;left:10px;top:10px">
                    <input class="knob Red" data-angleOffset="-135" data-angleArc="270" data-min="0" data-max="254" data-step="1" data-bgColor="#300" data-fgColor="#E33" data-displayInput=false data-width="300" data-height="300" data-thickness=".22">
                </div> 
                <div style="position:absolute;left:50px;top:50px">
                    <input class="knob Green" data-angleOffset="-135" data-angleArc="270" data-min="0" data-max="254" data-step="1" data-bgColor="#030" data-fgColor="#3E3" data-displayInput=false data-width="220" data-height="220" data-thickness=".30">
                </div>
                <div style="position:absolute;left:90px;top:90px">
                    <input class="knob Blue" data-angleOffset="-135" data-angleArc="270" data-min="0" data-max="254" data-step="1" data-bgColor="#003"data-fgColor="#33E" data-displayInput=false data-width="140" data-height="140" data-thickness=".45">
                </div>
                <div style="position:absolute;left:130px;top:130px">
                    <input class="knob White" data-angleOffset="-135" data-angleArc="270" data-min="0" data-max="254" data-step="1" data-bgColor="#222" data-fgColor="#EEE" data-displayInput=false data-width="60" data-height="60" data-thickness=".9">
                </div>
            </div>
	</div>
	<div class="button">
		<a href="#" class="myButton">Motion Detect[</a>
	</div>
</body>
</html>